{"version":3,"sources":["../../server/crud/db.js"],"names":["dotenv","config","connectionString","process","env","TEST_DATABASE_URL","NODE_ENV","DATABASE_URL","current_env","usersTable","tripsTable","bookingTable","getUserEmail","Promise","resolve","reject","client","Client","connect","then","sql","params","email","query","result","rows","end","catch","e","insertUsers","firstName","lastName","password","isAdmin","createTrip","details","busId","origin","destination","tripDate","tripTime","fare","getTrip","tripId","getAllTrips","bookingCheck","seatNumber","bookingData","data","userId","date","cancelTrip","clearTable","rowCount","clearTripTable","clearBookingTable","dummyTrip","status"],"mappings":"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","file":"db.js","sourcesContent":["import { Client } from 'pg';\nimport dotenv from 'dotenv';\n\ndotenv.config();\nlet connectionString;\nconnectionString = process.env.TEST_DATABASE_URL;\nconnectionString = process.env.TEST_DATABASE_URL;\nif (process.env.NODE_ENV === 'production') {\n  connectionString = process.env.DATABASE_URL;\n} else if (process.env.current_env === 'test') {\n  connectionString = process.env.TEST_DATABASE_URL;\n}\n\nconst usersTable = 'users';\nconst tripsTable = 'trips';\nconst bookingTable = 'bookings';\n\nconst getUserEmail = email => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `SELECT * FROM ${usersTable} WHERE user_email=$1`;\n      const params = [email];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst insertUsers = (firstName, lastName,\n  email, password, isAdmin) => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `INSERT INTO ${usersTable}(first_name,last_name,user_email,password,is_admin)VALUES($1,$2,$3,$4,$5)`;\n      const params = [firstName, lastName, email, password, isAdmin];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst createTrip = details => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `INSERT INTO ${tripsTable}\n      (bus_id,origin,destination,trip_date,trip_time,fare)VALUES($1,$2,$3,$4,$5,$6)`;\n      const params = [details.busId, details.origin,\n        details.destination, details.tripDate, details.tripTime, details.fare];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst getTrip = tripId => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `SELECT * FROM ${tripsTable} WHERE trip_id=$1`;\n      const params = [tripId];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst getAllTrips = () => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `SELECT * FROM ${tripsTable}`;\n      client.query(sql)\n        .then((result) => {\n          resolve(result.rows);\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst bookingCheck = (tripId, seatNumber) => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `SELECT * FROM ${bookingTable} WHERE trip_id=$1 AND seat_number=$2`;\n      const params = [tripId, seatNumber];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst bookingData = data => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `INSERT INTO ${bookingTable}(trip_id,user_id,created_on,seat_number)\n      VALUES($1,$2,$3,$4)`;\n      const params = [data.tripId, data.userId, data.date, data.seatNumber];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst cancelTrip = tripId => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `UPDATE ${tripsTable} SET status=false WHERE trip_id=$1`;\n      const params = [tripId];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst clearTable = () => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `DELETE FROM ${usersTable};`;\n      client.query(sql)\n        .then((result) => {\n          resolve(result.rowCount);\n          client.end();\n        })\n        .catch(e => reject(e));\n    }).catch(e => reject(e));\n});\n\nconst clearTripTable = () => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `DELETE FROM ${tripsTable};`;\n      client.query(sql)\n        .then((result) => {\n          resolve(result.rowCount);\n          client.end();\n        })\n        .catch(e => reject(e));\n    }).catch(e => reject(e));\n});\n\nconst clearBookingTable = () => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `DELETE FROM ${bookingTable};`;\n      client.query(sql)\n        .then((result) => {\n          resolve(result.rowCount);\n          client.end();\n        })\n        .catch(e => reject(e));\n    }).catch(e => reject(e));\n});\n\nconst dummyTrip = (tripId, busId, origin, destination, \n  tripDate, tripTime, fare, status) => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `INSERT INTO ${tripsTable}\n      (trip_id,bus_id,origin,destination,trip_date,trip_time,fare,status)VALUES($1,$2,$3,$4,$5,$6,$7,$8)`;\n      const params = [tripId, busId, origin,\n        destination, tripDate, tripTime, fare, status];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\n\nexport {\n  getUserEmail, insertUsers, clearTable,\n  createTrip, getTrip, cancelTrip, clearTripTable,\n  getAllTrips, bookingCheck, bookingData, clearBookingTable,\n  dummyTrip,\n};\n"]}
{"version":3,"sources":["../../server/crud/db.js"],"names":["dotenv","config","connectionString","process","env","TEST_DATABASE_URL","NODE_ENV","DATABASE_URL","current_env","usersTable","tripsTable","getUserEmail","Promise","resolve","reject","client","Client","connect","then","sql","params","email","query","result","rows","end","catch","e","insertUsers","firstName","lastName","password","isAdmin","createTrip","details","busId","origin","destination","tripDate","tripTime","fare","getTrip","tripId","cancelTrip","clearTable","rowCount","clearTripTable"],"mappings":"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","file":"db.js","sourcesContent":["import { Client } from 'pg';\nimport dotenv from 'dotenv';\n\ndotenv.config();\nlet connectionString;\nconnectionString = process.env.TEST_DATABASE_URL;\nconnectionString = process.env.TEST_DATABASE_URL;\nif (process.env.NODE_ENV === 'production') {\n  connectionString = process.env.DATABASE_URL;\n} else if (process.env.current_env === 'test') {\n  connectionString = process.env.TEST_DATABASE_URL;\n}\n\nconst usersTable = 'users';\nconst tripsTable = 'trips';\n// const bookingTable = 'bookings';\n\nconst getUserEmail = email => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `SELECT * FROM ${usersTable} WHERE user_email=$1`;\n      const params = [email];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst insertUsers = (firstName, lastName,\n  email, password, isAdmin) => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `INSERT INTO ${usersTable}(first_name,last_name,user_email,password,is_admin)VALUES($1,$2,$3,$4,$5)`;\n      const params = [firstName, lastName, email, password, isAdmin];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst createTrip = details => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `INSERT INTO ${tripsTable}\n      (bus_id,origin,destination,trip_date,trip_time,fare)VALUES($1,$2,$3,$4,$5,$6)`;\n      const params = [details.busId, details.origin,\n        details.destination, details.tripDate, details.tripTime, details.fare];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst getTrip = tripId => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `SELECT * FROM ${tripsTable} WHERE trip_id=$1`;\n      const params = [tripId];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst cancelTrip = tripId => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `UPDATE ${tripsTable} SET status=false WHERE trip_id=$1`;\n      const params = [tripId];\n      client.query(sql, params)\n        .then((result) => {\n          resolve(result.rows);\n          client.end();\n        }).catch((e) => {\n          reject(e);\n        });\n    }).catch((e) => {\n      reject(e);\n    });\n});\n\nconst clearTable = () => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `DELETE FROM ${usersTable};`;\n      client.query(sql)\n        .then((result) => {\n          resolve(result.rowCount);\n          client.end();\n        })\n        .catch(e => reject(e));\n    }).catch(e => reject(e));\n});\n\nconst clearTripTable = () => new Promise((resolve, reject) => {\n  const client = new Client(connectionString);\n  client.connect()\n    .then(() => {\n      const sql = `DELETE FROM ${tripsTable};`;\n      client.query(sql)\n        .then((result) => {\n          resolve(result.rowCount);\n          client.end();\n        })\n        .catch(e => reject(e));\n    }).catch(e => reject(e));\n});\n\n\nexport {\n  getUserEmail, insertUsers,\n  clearTable, createTrip, getTrip, cancelTrip, clearTripTable,\n};\n"]}
{"version":3,"sources":["../../server/test/booking.test.js"],"names":["describe","before","done","then","catch","e","it","app","post","send","tripId","seatNumber","set","expect","response","body","status","toBe","error","toContain","get","data","delete"],"mappings":"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","file":"booking.test.js","sourcesContent":["import expect from 'expect';\nimport request from 'supertest';\nimport app from '../app';\nimport { clearBookingTable } from '../crud/db';\n\ndescribe('POST /bookings, GET /bookings', () => {\n  before((done) => {\n    clearBookingTable()\n      .then(() => {\n        done();\n      }).catch(e => done(e));\n  });\n\n  it('should raise error for no trip record for signed in admin', () => request(app)\n    .post('/api/v1/bookings')\n    .send({\n      tripId: 30000,\n      seatNumber: 2,\n    })\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYzLCJmaXJzdE5hbWUiOiJKYWNvYiIsImxhc3ROYW1lIjoiTW9vcmUiLCJlbWFpbCI6ImphY29ubW9vcmVAd2F5ZmFyZXJhZG1pbi5jb20iLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE1NjIxODc4Njd9.QxKWLYmLbt_YzkuOcnm6znMgx6iuFFHwFwGn715DPNc')\n    .expect(404)\n    .then((response) => {\n      expect(response.body.status).toBe(404);\n      expect(response.body.error).toContain('Could not get trip Information');\n    }));\n\n  it('should raise error for an undefined input', () => request(app)\n    .post('/api/v1/bookings')\n    .send({\n      seatNumber: 2,\n    })\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYzLCJmaXJzdE5hbWUiOiJKYWNvYiIsImxhc3ROYW1lIjoiTW9vcmUiLCJlbWFpbCI6ImphY29ubW9vcmVAd2F5ZmFyZXJhZG1pbi5jb20iLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE1NjIxODc4Njd9.QxKWLYmLbt_YzkuOcnm6znMgx6iuFFHwFwGn715DPNc')\n    .expect(403)\n    .then((response) => {\n      expect(response.body.status).toBe(403);\n      expect(response.body.error).toContain('Missing input details');\n    }));\n\n  it('should raise error for booking a seat more than 36', () => request(app)\n    .post('/api/v1/bookings')\n    .send({\n      tripId: 2,\n      seatNumber: 39,\n    })\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYzLCJmaXJzdE5hbWUiOiJKYWNvYiIsImxhc3ROYW1lIjoiTW9vcmUiLCJlbWFpbCI6ImphY29ubW9vcmVAd2F5ZmFyZXJhZG1pbi5jb20iLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE1NjIxODc4Njd9.QxKWLYmLbt_YzkuOcnm6znMgx6iuFFHwFwGn715DPNc')\n    .expect(403)\n    .then((response) => {\n      expect(response.body.status).toBe(403);\n      expect(response.body.error).toContain('Ensure all fields are filled in correctly.Maximum number of seats is 36');\n    }));\n\n  it('should get all bookings for admin', () => request(app)\n    .get('/api/v1/bookings')\n    .send({\n      tripId: 2,\n      seatNumber: 5,\n    })\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYzLCJmaXJzdE5hbWUiOiJKYWNvYiIsImxhc3ROYW1lIjoiTW9vcmUiLCJlbWFpbCI6ImphY29ubW9vcmVAd2F5ZmFyZXJhZG1pbi5jb20iLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE1NjIxODc4Njd9.QxKWLYmLbt_YzkuOcnm6znMgx6iuFFHwFwGn715DPNc')\n    .expect(200)\n    .then((response) => {\n      expect(response.body.status).toBe(200);\n    }));\n\n  it('should not get booking without authentication', () => request(app)\n    .get('/api/v1/bookings')\n    .send({\n      tripId: 2,\n      seatNumber: 5,\n    })\n    .set('Accept', 'application/json')\n    .expect(401)\n    .then((response) => {\n      expect(response.body.status).toBe(401);\n      expect(response.body.error).toBe('Cannot authenticate user');\n    }));\n\n  it('should not get booking without proper authentication', () => request(app)\n    .get('/api/v1/bookings')\n    .send({\n      tripId: 2,\n      seatNumber: 5,\n    })\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYzLCJmaXJzdE5hbWUiOiJKYWNvY')\n    .expect(401)\n    .then((response) => {\n      expect(response.body.status).toBe(401);\n      expect(response.body.error).toBe('authentication failed!');\n    }));\n\n  it('should get booking', () => request(app)\n    .get('/api/v1/bookings')\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYzLCJmaXJzdE5hbWUiOiJKYWNvYiIsImxhc3ROYW1lIjoiTW9vcmUiLCJlbWFpbCI6ImphY29ubW9vcmVAd2F5ZmFyZXJhZG1pbi5jb20iLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE1NjIxODc4Njd9.QxKWLYmLbt_YzkuOcnm6znMgx6iuFFHwFwGn715DPNc')\n    .expect(200)\n    .then((response) => {\n      expect(response.body.status).toBe(200);\n    }));\n\n  it('should allow non-admin get booking information', () => request(app)\n    .get('/api/v1/bookings')\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjg1LCJmaXJzdE5hbWUiOiJKb3NodWEiLCJsYXN0TmFtZSI6IkZyYW5rc29uIiwiZW1haWwiOiJqb3NodWFmcmFua3NvbkBnbWFpbC5jb20iLCJpc0FkbWluIjpmYWxzZSwiaWF0IjoxNTYyMTg5OTg4fQ.pS7g3oVP_4hVL1ugeJZpr5JoBqDRACZJlS7uG9cFFGw')\n    .expect(200)\n    .then((response) => {\n      expect(response.body.status).toBe(200);\n      expect(response.body.data).toContain('No booking recorded');\n    }));\n\n  it('should not perform delete operation without proper authentication', () => request(app)\n    .delete('/api/v1/bookings/78')\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer yJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjg1LCJmaXJzdE5hbWUiOiJKb3NodWEiLCJsYXN0TmFtZSI6IkZyYW5rc29uIiwiZW1haWwiOiJqb3NodWFmcmFua3NvbkBnbWFpbC5jb20iLCJpc0FkbWluIjpmYWxzZSwiaWF0IjoxNTYyMTg5OTg4fQ.pS7g3oVP_4hVL1ugeJZpr5JoBqDRACZJlS7uG9cFFGw')\n    .expect(401)\n    .then((response) => {\n      expect(response.body.status).toBe(401);\n      expect(response.body.error).toContain('authentication failed!');\n    }));\n\n  it('should not perform delete operation without authentication', () => request(app)\n    .delete('/api/v1/bookings/78')\n    .set('Accept', 'application/json')\n    .expect(401)\n    .then((response) => {\n      expect(response.body.status).toBe(401);\n      expect(response.body.error).toContain('Cannot authenticate user');\n    }));\n\n  it('should raise error for unknown record', () => request(app)\n    .delete('/api/v1/bookings/645362734')\n    .set('Accept', 'application/json')\n    .set('Authorization', 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjg1LCJmaXJzdE5hbWUiOiJKb3NodWEiLCJsYXN0TmFtZSI6IkZyYW5rc29uIiwiZW1haWwiOiJqb3NodWFmcmFua3NvbkBnbWFpbC5jb20iLCJpc0FkbWluIjpmYWxzZSwiaWF0IjoxNTYyMTg5OTg4fQ.pS7g3oVP_4hVL1ugeJZpr5JoBqDRACZJlS7uG9cFFGw')\n    .expect(404)\n    .then((response) => {\n      expect(response.body.status).toBe(404);\n      expect(response.body.error).toContain('No booking found');\n    }));\n});\n"]}
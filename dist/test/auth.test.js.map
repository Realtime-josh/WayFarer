{"version":3,"sources":["../../server/test/auth.test.js"],"names":["describe","before","done","then","catch","e","it","app","post","send","firstName","lastName","email","password","set","expect","response","body","status","toBe","result","user_email","error","toContain","data","isAdmin","userId","toBeTruthy","console","log","end","err","res","toBeFalsy"],"mappings":"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","file":"auth.test.js","sourcesContent":["import expect from 'expect';\nimport request from 'supertest';\nimport app from '../app';\nimport { getUserEmail, clearTable } from '../crud/db';\n\ndescribe('POST /signup', () => {\n  before((done) => {\n    clearTable()\n      .then(() => {\n        done();\n      })\n      .catch(e => done(e));\n  });\n  it('should create a new user', () => request(app)\n    .post('/api/v1/auth/signup')\n    .send({\n      firstName: 'Joshua',\n      lastName: 'Frankson',\n      email: 'joshuafrankson@gmail.com',\n      password: 'regarded',\n    })\n    .set('Accept', 'application/json')\n    .expect(201)\n    .then((response) => {\n      expect(response.body.status).toBe(201);\n      // ensure user is in database\n      getUserEmail('joshuafrankson@gmail.com')\n        .then((result) => {\n          expect(result[0].user_email).toBe('joshuafrankson@gmail.com');\n        });\n    }));\n\n  it('should not create a user twice', () => request(app)\n    .post('/api/v1/auth/signup')\n    .send({\n      firstName: 'Joshua',\n      lastName: 'Frankson',\n      email: 'joshuafrankson@gmail.com',\n      password: 'regarded',\n    })\n    .set('Accept', 'application/json')\n    .expect(401)\n    .then((response) => {\n      expect(response.body.status).toBe(401);\n      expect(response.body.error).toContain('User already signed up');\n    }));\n\n  it('should create an account and identify a non admin', () => request(app)\n    .post('/api/v1/auth/signup')\n    .send({\n      firstName: 'Mark',\n      lastName: 'Clarke',\n      email: 'markclarke@gmail.com',\n      password: 'history',\n    })\n    .set('Accept', 'application/json')\n    .expect(201)\n    .then((response) => {\n      expect(response.body.status).toBe(201);\n      expect(response.body.data.isAdmin).toBe(false);\n      expect(response.body.data.userId).toBeTruthy();\n      // ensure user is in database\n      getUserEmail('markclarke@gmail.com')\n        .then((result) => {\n          expect(result[0].user_email).toBe('markclarke@gmail.com');\n        }).catch(() => {\n          console.log('Bug found');\n        });\n    }));\n\n  it('should create an account and identify an admin', () => request(app)\n    .post('/api/v1/auth/signup')\n    .send({\n      firstName: 'Jacob',\n      lastName: 'Moore',\n      email: 'jaconmoore@wayfareradmin.com',\n      password: 'history',\n    })\n    .set('Accept', 'application/json')\n    .expect(201)\n    .then((response) => {\n      expect(response.body.status).toBe(201);\n      expect(response.body.data.isAdmin).toBe(true);\n      expect(response.body.data.userId).toBeTruthy();\n      // ensure user is in database\n      getUserEmail('jaconmoore@wayfareradmin.com')\n        .then((result) => {\n          expect(result[0].user_email).toBe('jaconmoore@wayfareradmin.com');\n        });\n    }));\n\n  it('should check that all input fields are filled correctly', (done) => {\n    request(app)\n      .post('/api/v1/auth/signup')\n      .send({\n        firstName: 'James',\n        lastName: 'Clown',\n        email: 'jamesclown@gmail.com',\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n      .expect('Content-Type', /json/)\n      .end((err, res) => {\n        if (err) done(err);\n        expect(res.body.status).toBe(400);\n        expect(res.body.isAdmin).toBeFalsy();\n        expect(res.body.error).toContain('Ensure that all fields are correctly filled out');\n      });\n    done();\n  });\n\n  it('should check for strong password', (done) => {\n    request(app)\n      .post('/api/v1/auth/signup')\n      .send({\n        firstName: 'James',\n        lastName: 'Clown',\n        email: 'jamesclown@gmail.com',\n        password: 'to',\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n      .expect('Content-Type', /json/)\n      .end((err, res) => {\n        if (err) done(err);\n        expect(res.body.status).toBe(400);\n        expect(res.body.isAdmin).toBeFalsy();\n        expect(res.body.error).toContain('Ensure username, email and password are valid entries');\n      });\n    done();\n  });\n});\n"]}